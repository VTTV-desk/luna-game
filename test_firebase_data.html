<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Firebase Test - Moonlight Delivery Luna</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #1a1a1a;
      color: #fff;
    }
    .section {
      background: #2a2a2a;
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }
    button {
      background: #6B4FA0;
      color: white;
      border: none;
      padding: 12px 24px;
      margin: 5px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }
    button:hover {
      background: #8B6FC0;
    }
    #output {
      background: #000;
      padding: 15px;
      margin: 10px 0;
      border-radius: 4px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 400px;
      overflow-y: auto;
    }
    .success { color: #4CAF50; }
    .error { color: #f44336; }
    .info { color: #2196F3; }
    .warning { color: #FF9800; }
  </style>
</head>
<body>
  <h1>ğŸ”¥ Firebase í…ŒìŠ¤íŠ¸ - ë‹¬ë¹› ë°°ë‹¬ë¶€ ë£¨ë‚˜</h1>
  
  <div class="section">
    <h2>1. Firebase ì´ˆê¸°í™”</h2>
    <button onclick="initFirebase()">Firebase ì´ˆê¸°í™”</button>
    <button onclick="checkFirestore()">Firestore ì—°ê²° í™•ì¸</button>
  </div>
  
  <div class="section">
    <h2>2. í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€</h2>
    <button onclick="addTestScores()">í…ŒìŠ¤íŠ¸ ì ìˆ˜ 10ê°œ ì¶”ê°€</button>
    <button onclick="initializeStats()">í†µê³„ ì´ˆê¸°í™”</button>
  </div>
  
  <div class="section">
    <h2>3. ë°ì´í„° ì¡°íšŒ</h2>
    <button onclick="loadTopScores()">TOP 10 ì ìˆ˜ ì¡°íšŒ</button>
    <button onclick="loadStats()">í†µê³„ ì¡°íšŒ</button>
    <button onclick="countAllScores()">ì „ì²´ ì ìˆ˜ ê°œìˆ˜</button>
  </div>
  
  <div class="section">
    <h2>4. ë°ì´í„° ì •ë¦¬</h2>
    <button onclick="deleteAllScores()" style="background: #f44336;">ëª¨ë“  ì ìˆ˜ ì‚­ì œ</button>
  </div>
  
  <div class="section">
    <h2>ğŸ“‹ ì¶œë ¥</h2>
    <div id="output">ì¤€ë¹„ ì™„ë£Œ. ìœ„ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ Firebaseë¥¼ í…ŒìŠ¤íŠ¸í•˜ì„¸ìš”.</div>
  </div>

  <script>
    let db = null;
    
    function log(message, type = 'info') {
      const output = document.getElementById('output');
      const timestamp = new Date().toLocaleTimeString();
      const className = type;
      output.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
      output.scrollTop = output.scrollHeight;
      console.log(message);
    }
    
    function clearLog() {
      document.getElementById('output').innerHTML = '';
    }
    
    async function initFirebase() {
      try {
        clearLog();
        log('ğŸ”¥ Firebase ì´ˆê¸°í™” ì‹œì‘...', 'info');
        
        const firebaseConfig = {
          apiKey: "AIzaSyCHSmJ3B7GA-5sjKusRZb3-yvefAqlLSUk",
          authDomain: "moonlight-delivery-luna.firebaseapp.com",
          projectId: "moonlight-delivery-luna",
          storageBucket: "moonlight-delivery-luna.firebasestorage.app",
          messagingSenderId: "205380684633",
          appId: "1:205380684633:web:00f86a112a9186b6611a48",
        };
        
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        
        db = firebase.firestore();
        log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ!', 'success');
        log('âœ… Firestore ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ì™„ë£Œ', 'success');
        
      } catch (error) {
        log(`âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
        log(`ìƒì„¸ ì—ëŸ¬: ${error.stack}`, 'error');
      }
    }
    
    async function checkFirestore() {
      try {
        if (!db) {
          log('âš ï¸ Firebaseê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ë¨¼ì € ì´ˆê¸°í™”í•˜ì„¸ìš”.', 'warning');
          return;
        }
        
        log('ğŸ” Firestore ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...', 'info');
        
        // í…ŒìŠ¤íŠ¸ ì¿¼ë¦¬ ì‹¤í–‰
        const testQuery = await db.collection('scores').limit(1).get();
        log(`âœ… Firestore ì—°ê²° ì„±ê³µ! (${testQuery.size}ê°œ ë¬¸ì„œ ë°œê²¬)`, 'success');
        
      } catch (error) {
        log(`âŒ Firestore ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
        log('ğŸ’¡ ë³´ì•ˆ ê·œì¹™ì„ í™•ì¸í•˜ì„¸ìš”!', 'warning');
      }
    }
    
    async function addTestScores() {
      try {
        if (!db) {
          await initFirebase();
        }
        
        log('ğŸ“ í…ŒìŠ¤íŠ¸ ì ìˆ˜ ì¶”ê°€ ì¤‘...', 'info');
        
        const testPlayers = [
          { name: 'ë£¨ë‚˜', score: 1500, candies: 150 },
          { name: 'ë…¸ì„', score: 1200, candies: 120 },
          { name: 'ë³„ì´', score: 1000, candies: 100 },
          { name: 'êµ¬ë¦„', score: 900, candies: 90 },
          { name: 'ë‹¬ë¹›', score: 800, candies: 80 },
          { name: 'í•˜ëŠ˜', score: 700, candies: 70 },
          { name: 'ë°”ëŒ', score: 600, candies: 60 },
          { name: 'ê½ƒí–¥ê¸°', score: 500, candies: 50 },
          { name: 'ì´ìŠ¬', score: 400, candies: 40 },
          { name: 'ë¬´ì§€ê°œ', score: 300, candies: 30 },
        ];
        
        const batch = db.batch();
        const today = new Date().toISOString().split('T')[0];
        
        for (let i = 0; i < testPlayers.length; i++) {
          const player = testPlayers[i];
          const docRef = db.collection('scores').doc();
          batch.set(docRef, {
            player_id: `test_player_${i}`,
            player_name: player.name,
            score: player.score,
            candies: player.candies,
            monsters_killed: Math.floor(player.score / 20),
            timestamp: firebase.firestore.FieldValue.serverTimestamp(),
            date: today,
          });
        }
        
        await batch.commit();
        log(`âœ… ${testPlayers.length}ê°œì˜ í…ŒìŠ¤íŠ¸ ì ìˆ˜ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤!`, 'success');
        
      } catch (error) {
        log(`âŒ í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¶”ê°€ ì‹¤íŒ¨: ${error.message}`, 'error');
      }
    }
    
    async function initializeStats() {
      try {
        if (!db) {
          await initFirebase();
        }
        
        log('ğŸ“Š í†µê³„ ì´ˆê¸°í™” ì¤‘...', 'info');
        
        const today = new Date().toISOString().split('T')[0];
        
        // ì˜¤ëŠ˜ í†µê³„
        await db.collection('stats').doc(`daily_${today}`).set({
          date: today,
          players: 10,
        }, { merge: true });
        
        // ì „ì²´ í†µê³„
        await db.collection('stats').doc('total').set({
          total_players: 10,
          last_updated: firebase.firestore.FieldValue.serverTimestamp(),
        }, { merge: true });
        
        log('âœ… í†µê³„ ì´ˆê¸°í™” ì™„ë£Œ!', 'success');
        
      } catch (error) {
        log(`âŒ í†µê³„ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
      }
    }
    
    async function loadTopScores() {
      try {
        if (!db) {
          await initFirebase();
        }
        
        log('ğŸ† TOP 10 ì ìˆ˜ ì¡°íšŒ ì¤‘...', 'info');
        
        const querySnapshot = await db.collection('scores')
          .orderBy('score', 'desc')
          .limit(10)
          .get();
        
        log(`ğŸ“‹ ì´ ${querySnapshot.size}ê°œì˜ ì ìˆ˜ë¥¼ ì°¾ì•˜ìŠµë‹ˆë‹¤:`, 'success');
        
        querySnapshot.forEach((doc, index) => {
          const data = doc.data();
          log(`${index + 1}. ${data.player_name}: ${data.score}ì  (ì‚¬íƒ•: ${data.candies})`, 'info');
        });
        
      } catch (error) {
        log(`âŒ ì ìˆ˜ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
      }
    }
    
    async function loadStats() {
      try {
        if (!db) {
          await initFirebase();
        }
        
        log('ğŸ“Š í†µê³„ ì¡°íšŒ ì¤‘...', 'info');
        
        const today = new Date().toISOString().split('T')[0];
        
        // ì „ì²´ í†µê³„
        const totalDoc = await db.collection('stats').doc('total').get();
        if (totalDoc.exists) {
          const data = totalDoc.data();
          log(`ğŸ“ˆ ì „ì²´ í”Œë ˆì´ì–´ ìˆ˜: ${data.total_players}`, 'success');
        } else {
          log('âš ï¸ ì „ì²´ í†µê³„ ë°ì´í„° ì—†ìŒ', 'warning');
        }
        
        // ì˜¤ëŠ˜ í†µê³„
        const dailyDoc = await db.collection('stats').doc(`daily_${today}`).get();
        if (dailyDoc.exists) {
          const data = dailyDoc.data();
          log(`ğŸ“… ì˜¤ëŠ˜ í”Œë ˆì´ì–´ ìˆ˜: ${data.players}`, 'success');
        } else {
          log('âš ï¸ ì˜¤ëŠ˜ í†µê³„ ë°ì´í„° ì—†ìŒ', 'warning');
        }
        
      } catch (error) {
        log(`âŒ í†µê³„ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}`, 'error');
      }
    }
    
    async function countAllScores() {
      try {
        if (!db) {
          await initFirebase();
        }
        
        log('ğŸ”¢ ì „ì²´ ì ìˆ˜ ê°œìˆ˜ í™•ì¸ ì¤‘...', 'info');
        
        const querySnapshot = await db.collection('scores').get();
        log(`ğŸ“Š ì „ì²´ ì ìˆ˜ ê°œìˆ˜: ${querySnapshot.size}ê°œ`, 'success');
        
      } catch (error) {
        log(`âŒ ê°œìˆ˜ í™•ì¸ ì‹¤íŒ¨: ${error.message}`, 'error');
      }
    }
    
    async function deleteAllScores() {
      try {
        if (!confirm('ì •ë§ë¡œ ëª¨ë“  ì ìˆ˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          return;
        }
        
        if (!db) {
          await initFirebase();
        }
        
        log('ğŸ—‘ï¸ ëª¨ë“  ì ìˆ˜ ì‚­ì œ ì¤‘...', 'warning');
        
        const querySnapshot = await db.collection('scores').get();
        const batch = db.batch();
        
        querySnapshot.forEach(doc => {
          batch.delete(doc.ref);
        });
        
        await batch.commit();
        log(`âœ… ${querySnapshot.size}ê°œì˜ ì ìˆ˜ë¥¼ ì‚­ì œí–ˆìŠµë‹ˆë‹¤.`, 'success');
        
      } catch (error) {
        log(`âŒ ì‚­ì œ ì‹¤íŒ¨: ${error.message}`, 'error');
      }
    }
    
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì´ˆê¸°í™”
    window.onload = function() {
      log('ğŸ‘‹ Firebase í…ŒìŠ¤íŠ¸ ë„êµ¬ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤!', 'success');
      log('ë¨¼ì € "Firebase ì´ˆê¸°í™”" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.', 'info');
    };
  </script>
</body>
</html>
